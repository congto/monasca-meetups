https://horizon.hpcloud.com/

openstack_meetup_sunnyvale_aug_2015

# Set up an instance in the public cloud

############### TERMINAL 1 ###############

# Connect to the public cloud instance
ssh-keygen -R 15.126.219.85
ssh -i default.pem core@15.126.219.85 -L 8183:localhost:8083 -L 8100:localhost:80 -L 8180:localhost:8080 -L 5100:localhost:5000

wget https://horizon.hpcloud.com/project/containers/openstack_meetup_sunnyvale_aug_2015/default.pem

# Run a Docker Ubuntu container
docker run -i -t ubuntu /bin/bash

# Install Git so we can clone the Monasca Docker demo
apt-get install git -y

# Clone repo
git clone https://github.com/hpcloud-mon/monasca-docker.git

# Close container
exit

# Back on the Docker target host (15.126.219.85) find the Ubuntu container ID
docker ps -a

# Copy the closed repo in the container to the Docker host
docker cp 04232a59ec1b:/monasca-docker .

# Run the Monasca Docker demo
cd monasca-docker
docker run -d -p 8083:8083 -p 80:80 -p 8080:8080 -p 5000:5000 --name monasca monasca/demo

############### TERMINAL 2 ###############

# Connect to the public cloud instance
ssh -i default.pem core@15.126.219.85

# From the Docker target host (15.126.219.85) start a bash shell on the Monasca container
# you need the --login to read your .profile
docker exec -ti 8892698f020c /bin/bash --login

# Install some useful utilities
apt-get install most tree vim alpine curl openjdk-8-jdk -y

# Set up the credentials so the monasca CLI will work
echo "" /root/.profile
echo "export LANG=en_US.UTF-8" >> /root/.profile
echo "export TERM=vt100" >> /root/.profile
echo "export OS_PROJECT_NAME=mini-mon" >> /root/.profile
echo "export OS_PASSWORD=password" >> /root/.profile
echo "export OS_AUTH_URL=http://localhost:35357/v3/" >> /root/.profile
echo "export OS_USERNAME=mini-mon" >> /root/.profile
echo "# Use the Monasca Python virtualenv" >> /root/.profile
echo "source /opt/monasca/bin/activate" >> /root/.profile

# Generate a US locale
localedef -v -c -i en_US -f UTF-8 en_US.UTF-8

# Bring the credentials in to our current shell
source /root/.profile

# Start the notification engine
/opt/monasca/bin/python /opt/monasca/bin/monasca-notification

# Start the Monasca Persister
/usr/bin/java -Dfile.encoding=UTF-8 -Xmx1g -cp /opt/monasca/monasca-persister.jar:/opt/monasca/vertica/vertica_jdbc.jar monasca.persister.PersisterApplication server /etc/monasca/persister-config.yml

# Install the smoke tests
curl -L https://github.com/hpcloud-mon/monasca-ci/tarball/master | tar zx && cp -R ./hpcloud-mon-monasca-ci-*/tests /opt/monasca

# Run the smoke tests
/opt/monasca/tests/smoke/smoke.py


